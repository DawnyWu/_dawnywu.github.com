<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>js-metaprogramming</title>
  <meta name="description" content="reflective metaprogramming">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="http://localhost:4000/js/2016/11/08/metaprogramming.html">
  <link rel="alternate" type="application/rss+xml" title="" href="http://localhost:4000/feed.xml">
</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/"></a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger">
        
          
          <a class="page-link" href="/about/">About</a>
          
        
          
        
          
        
          
        
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">js-metaprogramming</h1>
    <p class="post-meta"><time datetime="2016-11-08T00:00:00+08:00" itemprop="datePublished">Nov 8, 2016</time></p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <h3 id="reflective-metaprogramming">reflective metaprogramming</h3>

<p>Introspection: you have read-only access to the structure of a program.
Self-modification: you can change that structure.
Intercession: you can redefine the semantics of some language operations.</p>

<p>如果不截断target的方法的话，对proxy的操作会直接作 用于target</p>

<p><strong><em>target可以是object</em></strong></p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="kr">const</span> <span class="nx">target</span> <span class="o">=</span> <span class="p">{};</span>
<span class="kr">const</span> <span class="nx">handler</span> <span class="o">=</span> <span class="p">{</span>
    <span class="cm">/** Intercepts: getting properties */</span>
    <span class="nx">get</span><span class="p">(</span><span class="nx">target</span><span class="p">,</span> <span class="nx">propKey</span><span class="p">,</span> <span class="nx">receiver</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="err">`</span><span class="nx">GET</span> <span class="nx">$</span><span class="p">{</span><span class="nx">propKey</span><span class="p">}</span><span class="err">`</span><span class="p">);</span>
        <span class="k">return</span> <span class="mi">123</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="cm">/** Intercepts: checking whether properties exist */</span>
    <span class="nx">has</span><span class="p">(</span><span class="nx">target</span><span class="p">,</span> <span class="nx">propKey</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="err">`</span><span class="nx">HAS</span> <span class="nx">$</span><span class="p">{</span><span class="nx">propKey</span><span class="p">}</span><span class="err">`</span><span class="p">);</span>
        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>
<span class="kr">const</span> <span class="nx">proxy</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Proxy</span><span class="p">(</span><span class="nx">target</span><span class="p">,</span> <span class="nx">handler</span><span class="p">);</span>
</code></pre>
</div>

<p>proxy截断has, get方法，但不会截断set</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="nx">proxy</span><span class="p">.</span><span class="nx">bar</span> <span class="o">=</span> <span class="s1">'abc'</span><span class="p">;</span>
<span class="nx">target</span><span class="p">.</span><span class="nx">bar</span>
<span class="c1">// 'abc'</span>
</code></pre>
</div>

<p><strong><em>target可以是function</em></strong></p>

<p>apply: Making a function call, triggered via
  proxy(···)
  proxy.call(···)
  proxy.apply(···)
construct: Making a constructor call, triggered via
  new proxy(···)</p>

<p><strong><em>Intercepting method calls</em></strong></p>

<p>method calls are viewed as two separate operations: First a get to retrieve a function, then an apply to call that function.</p>

<p>一个截断方法的例子，实际上截断的是get方法。。。</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="kr">const</span> <span class="nx">obj</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">multiply</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">x</span> <span class="o">*</span> <span class="nx">y</span><span class="p">;</span>
    <span class="p">},</span>
    <span class="nx">squared</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">multiply</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">x</span><span class="p">);</span>
    <span class="p">},</span>
<span class="p">};</span>

<span class="c1">// traceMethodCalls(obj)会创建一个obj的proxy</span>
<span class="kd">function</span> <span class="nx">traceMethodCalls</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">handler</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">get</span><span class="p">(</span><span class="nx">target</span><span class="p">,</span> <span class="nx">propKey</span><span class="p">,</span> <span class="nx">receiver</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// 获得target method</span>
            <span class="kr">const</span> <span class="nx">origMethod</span> <span class="o">=</span> <span class="nx">target</span><span class="p">[</span><span class="nx">propKey</span><span class="p">];</span>
            <span class="k">return</span> <span class="kd">function</span> <span class="p">(...</span><span class="nx">args</span><span class="p">)</span> <span class="p">{</span>
                <span class="kr">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">origMethod</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
                <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">propKey</span> <span class="o">+</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">args</span><span class="p">)</span>
                    <span class="o">+</span> <span class="s1">' -&gt; '</span> <span class="o">+</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">result</span><span class="p">));</span>
                <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
            <span class="p">};</span>
        <span class="p">}</span>
    <span class="p">};</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">Proxy</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">handler</span><span class="p">);</span>
<span class="p">}</span>

<span class="kr">const</span> <span class="nx">tracedObj</span> <span class="o">=</span> <span class="nx">traceMethodCalls</span><span class="p">(</span><span class="nx">obj</span><span class="p">);</span>

<span class="nx">tracedObj</span><span class="p">.</span><span class="nx">multiply</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">7</span><span class="p">)</span>
<span class="c1">// multiply[2,7] -&gt; 14</span>
<span class="c1">// 14</span>
<span class="nx">tracedObj</span><span class="p">.</span><span class="nx">squared</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span>
<span class="c1">// multiply[9,9] -&gt; 81</span>
<span class="c1">// squared[9] -&gt; 81</span>
<span class="c1">// 81</span>
</code></pre>
</div>

<p><strong><em>Revocable proxies</em></strong></p>

<p>const {proxy, revoke} = Proxy.revocable(target, handler);</p>

<p>After you call the function revoke for the first time, any operation you apply to proxy causes a TypeError. Subsequent calls of revoke have no further effect.</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="kr">const</span> <span class="nx">target</span> <span class="o">=</span> <span class="p">{};</span> <span class="c1">// Start with an empty object</span>
<span class="kr">const</span> <span class="nx">handler</span> <span class="o">=</span> <span class="p">{};</span> <span class="c1">// Don’t intercept anything</span>
<span class="kr">const</span> <span class="p">{</span><span class="nx">proxy</span><span class="p">,</span> <span class="nx">revoke</span><span class="p">}</span> <span class="o">=</span> <span class="nx">Proxy</span><span class="p">.</span><span class="nx">revocable</span><span class="p">(</span><span class="nx">target</span><span class="p">,</span> <span class="nx">handler</span><span class="p">);</span>

<span class="nx">proxy</span><span class="p">.</span><span class="nx">foo</span> <span class="o">=</span> <span class="mi">123</span><span class="p">;</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">proxy</span><span class="p">.</span><span class="nx">foo</span><span class="p">);</span> <span class="c1">// 123</span>

<span class="nx">revoke</span><span class="p">();</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">proxy</span><span class="p">.</span><span class="nx">foo</span><span class="p">);</span> <span class="c1">// TypeError: Revoked</span>
</code></pre>
</div>

<p><strong><em>Proxies as prototypes</em></strong></p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="kr">const</span> <span class="nx">proto</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Proxy</span><span class="p">({},</span> <span class="p">{</span>
    <span class="nx">get</span><span class="p">(</span><span class="nx">target</span><span class="p">,</span> <span class="nx">propertyKey</span><span class="p">,</span> <span class="nx">receiver</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'GET '</span><span class="o">+</span><span class="nx">propertyKey</span><span class="p">);</span>
        <span class="k">return</span> <span class="nx">target</span><span class="p">[</span><span class="nx">propertyKey</span><span class="p">];</span>
    <span class="p">}</span>
<span class="p">});</span>

<span class="kr">const</span> <span class="nx">obj</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">proto</span><span class="p">);</span>
<span class="nx">obj</span><span class="p">.</span><span class="nx">bla</span><span class="p">;</span>

<span class="c1">// Output:</span>
<span class="c1">// GET bla</span>
</code></pre>
</div>

<p><strong><em>Forwarding intercepted operations</em></strong></p>

<p>感觉相当于middleware，在中间做一些事情，最后还是操作target</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="kr">const</span> <span class="nx">handler</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">deleteProperty</span><span class="p">(</span><span class="nx">target</span><span class="p">,</span> <span class="nx">propKey</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'DELETE '</span> <span class="o">+</span> <span class="nx">propKey</span><span class="p">);</span>
        <span class="k">return</span> <span class="k">delete</span> <span class="nx">target</span><span class="p">[</span><span class="nx">propKey</span><span class="p">];</span>
        <span class="c1">// return Reflect.deleteProperty(target, propKey);</span>
    <span class="p">},</span>
    <span class="nx">has</span><span class="p">(</span><span class="nx">target</span><span class="p">,</span> <span class="nx">propKey</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'HAS '</span> <span class="o">+</span> <span class="nx">propKey</span><span class="p">);</span>
        <span class="k">return</span> <span class="nx">propKey</span> <span class="k">in</span> <span class="nx">target</span><span class="p">;</span>
        <span class="c1">// return Reflect.has(target, propKey);</span>
    <span class="p">},</span>
    <span class="c1">// Other traps: similar</span>
<span class="p">}</span>
</code></pre>
</div>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="kr">const</span> <span class="nx">handler</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Proxy</span><span class="p">({},</span> <span class="p">{</span>
    <span class="nx">get</span><span class="p">(</span><span class="nx">target</span><span class="p">,</span> <span class="nx">trapName</span><span class="p">,</span> <span class="nx">receiver</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Return the handler method named trapName</span>
        <span class="k">return</span> <span class="kd">function</span> <span class="p">(...</span><span class="nx">args</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// Don’t log args[0]</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">trapName</span><span class="p">.</span><span class="nx">toUpperCase</span><span class="p">()</span><span class="o">+</span><span class="s1">' '</span><span class="o">+</span><span class="nx">args</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span>
            <span class="c1">// Forward the operation</span>
            <span class="k">return</span> <span class="nx">Reflect</span><span class="p">[</span><span class="nx">trapName</span><span class="p">](...</span><span class="nx">args</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">});</span>
</code></pre>
</div>

<p><strong><em>Tracing property accesses (get, set)</em></strong></p>

<p>我们要写一个方法tracePropAccess(),logs whenever a property of obj, whose key is in the Array propKeys, is set or got.</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="kr">class</span> <span class="nx">Point</span> <span class="p">{</span>
    <span class="nx">constructor</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">x</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nx">y</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nx">toString</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="err">`</span><span class="nx">Point</span><span class="p">(</span><span class="nx">$</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">x</span><span class="p">},</span> <span class="nx">$</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">y</span><span class="p">})</span><span class="err">`</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="c1">// Trace accesses to properties `x` and `y`</span>
<span class="kr">const</span> <span class="nx">p</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">);</span>
<span class="nx">p</span> <span class="o">=</span> <span class="nx">tracePropAccess</span><span class="p">(</span><span class="nx">p</span><span class="p">,</span> <span class="p">[</span><span class="s1">'x'</span><span class="p">,</span> <span class="s1">'y'</span><span class="p">]);</span>

<span class="nx">p</span><span class="p">.</span><span class="nx">x</span>
<span class="c1">// GET x</span>
<span class="c1">// 5</span>
<span class="nx">p</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="mi">21</span>
<span class="c1">// SET x=21</span>
<span class="c1">// 21</span>
</code></pre>
</div>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">tracePropAccess</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">propKeys</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Store the property data here</span>
    <span class="kr">const</span> <span class="nx">propData</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
    <span class="c1">// Replace each property with a getter and a setter</span>
    <span class="nx">propKeys</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">propKey</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">propData</span><span class="p">[</span><span class="nx">propKey</span><span class="p">]</span> <span class="o">=</span> <span class="nx">obj</span><span class="p">[</span><span class="nx">propKey</span><span class="p">];</span>
        <span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">propKey</span><span class="p">,</span> <span class="p">{</span>
            <span class="na">get</span><span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
                <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'GET '</span><span class="o">+</span><span class="nx">propKey</span><span class="p">);</span>
                <span class="k">return</span> <span class="nx">propData</span><span class="p">[</span><span class="nx">propKey</span><span class="p">];</span>
            <span class="p">},</span>
            <span class="na">set</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'SET '</span><span class="o">+</span><span class="nx">propKey</span><span class="o">+</span><span class="s1">'='</span><span class="o">+</span><span class="nx">value</span><span class="p">);</span>
                <span class="nx">propData</span><span class="p">[</span><span class="nx">propKey</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span>
            <span class="p">},</span>
        <span class="p">});</span>
    <span class="p">});</span>
    <span class="k">return</span> <span class="nx">obj</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
</div>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">tracePropAccess</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">propKeys</span><span class="p">)</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">propKeySet</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Set</span><span class="p">(</span><span class="nx">propKeys</span><span class="p">);</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">Proxy</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="p">{</span>
        <span class="nx">get</span><span class="p">(</span><span class="nx">target</span><span class="p">,</span> <span class="nx">propKey</span><span class="p">,</span> <span class="nx">receiver</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">propKeySet</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="nx">propKey</span><span class="p">))</span> <span class="p">{</span>
                <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'GET '</span><span class="o">+</span><span class="nx">propKey</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="nx">Reflect</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">target</span><span class="p">,</span> <span class="nx">propKey</span><span class="p">,</span> <span class="nx">receiver</span><span class="p">);</span>
        <span class="p">},</span>
        <span class="nx">set</span><span class="p">(</span><span class="nx">target</span><span class="p">,</span> <span class="nx">propKey</span><span class="p">,</span> <span class="nx">value</span><span class="p">,</span> <span class="nx">receiver</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">propKeySet</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="nx">propKey</span><span class="p">))</span> <span class="p">{</span>
                <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'SET '</span><span class="o">+</span><span class="nx">propKey</span><span class="o">+</span><span class="s1">'='</span><span class="o">+</span><span class="nx">value</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="nx">Reflect</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">target</span><span class="p">,</span> <span class="nx">propKey</span><span class="p">,</span> <span class="nx">value</span><span class="p">,</span> <span class="nx">receiver</span><span class="p">);</span>
        <span class="p">},</span>
    <span class="p">});</span>
<span class="p">}</span>
</code></pre>
</div>

<p><strong><em>Warning about unknown properties (get, set)</em></strong></p>

<p>We make the proxy a prototype of an object.</p>

<p>If a property isn’t found in the object, the get trap of the proxy is triggered. If the property doesn’t even exist in the prototype chain after the proxy, it really is missing and we throw an exception</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="kr">const</span> <span class="nx">PropertyChecker</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Proxy</span><span class="p">({},</span> <span class="p">{</span>
    <span class="nx">get</span><span class="p">(</span><span class="nx">target</span><span class="p">,</span> <span class="nx">propKey</span><span class="p">,</span> <span class="nx">receiver</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nx">propKey</span> <span class="k">in</span> <span class="nx">target</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">ReferenceError</span><span class="p">(</span><span class="s1">'Unknown property: '</span><span class="o">+</span><span class="nx">propKey</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">Reflect</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">target</span><span class="p">,</span> <span class="nx">propKey</span><span class="p">,</span> <span class="nx">receiver</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">});</span>


<span class="kr">const</span> <span class="nx">obj</span> <span class="o">=</span> <span class="p">{</span> <span class="na">__proto__</span><span class="p">:</span> <span class="nx">PropertyChecker</span><span class="p">,</span> <span class="na">foo</span><span class="p">:</span> <span class="mi">123</span> <span class="p">};</span>
<span class="nx">obj</span><span class="p">.</span><span class="nx">foo</span>  <span class="c1">// own</span>
<span class="c1">// 123</span>
<span class="nx">obj</span><span class="p">.</span><span class="nx">fo</span>
<span class="c1">// ReferenceError: Unknown property: fo</span>
<span class="nx">obj</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>  <span class="c1">// inherited</span>
<span class="c1">// '[object Object]'</span>
</code></pre>
</div>

<h4 id="inobjkey-proto">in检测obj中有没有相应的key, 但是不是会去__proto__中去找呢？</h4>

<p>会的</p>

<p>感觉好像如果要做middleware，直接proxy object</p>

<p>如果想要在obj之后做兜底，要做obj的proto</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">PropertyChecker</span><span class="p">()</span> <span class="p">{</span> <span class="p">}</span>
<span class="nx">PropertyChecker</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Proxy</span><span class="p">(</span><span class="err">···</span><span class="p">);</span>

<span class="kr">class</span> <span class="nx">Point</span> <span class="kr">extends</span> <span class="nx">PropertyChecker</span> <span class="p">{</span>
    <span class="nx">constructor</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">x</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nx">y</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kr">const</span> <span class="nx">p</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">p</span><span class="p">.</span><span class="nx">x</span><span class="p">);</span> <span class="c1">// 5</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">p</span><span class="p">.</span><span class="nx">z</span><span class="p">);</span> <span class="c1">// ReferenceError</span>
</code></pre>
</div>

<h4 id="obj">想要避免obj生成属性，有两种办法</h4>

<ul>
  <li>You can either wrap a proxy around objects that traps set</li>
  <li>via Object.preventExtensions(obj)</li>
</ul>

<p><strong>**Negative Array indices (get)</strong>**</p>

<p>JavaScript 不支持这种</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="kd">let</span> <span class="nx">a</span> <span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="nx">a</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="c1">//=&gt; undefined</span>
</code></pre>
</div>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">createArray</span><span class="p">(...</span><span class="nx">elements</span><span class="p">)</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">handler</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">get</span><span class="p">(</span><span class="nx">target</span><span class="p">,</span> <span class="nx">propKey</span><span class="p">,</span> <span class="nx">receiver</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// Sloppy way of checking for negative indices</span>
            <span class="kr">const</span> <span class="nx">index</span> <span class="o">=</span> <span class="nb">Number</span><span class="p">(</span><span class="nx">propKey</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">index</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">propKey</span> <span class="o">=</span> <span class="nb">String</span><span class="p">(</span><span class="nx">target</span><span class="p">.</span><span class="nx">length</span> <span class="o">+</span> <span class="nx">index</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="nx">Reflect</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">target</span><span class="p">,</span> <span class="nx">propKey</span><span class="p">,</span> <span class="nx">receiver</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">};</span>
    <span class="c1">// Wrap a proxy around an Array</span>
    <span class="kr">const</span> <span class="nx">target</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="nx">target</span><span class="p">.</span><span class="nx">push</span><span class="p">(...</span><span class="nx">elements</span><span class="p">);</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">Proxy</span><span class="p">(</span><span class="nx">target</span><span class="p">,</span> <span class="nx">handler</span><span class="p">);</span>
<span class="p">}</span>
<span class="kr">const</span> <span class="nx">arr</span> <span class="o">=</span> <span class="nx">createArray</span><span class="p">(</span><span class="s1">'a'</span><span class="p">,</span> <span class="s1">'b'</span><span class="p">,</span> <span class="s1">'c'</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">arr</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]);</span> <span class="c1">// c</span>
</code></pre>
</div>

<p><strong><em>check type safe</em></strong></p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">createTypeSafeObject</span><span class="p">(</span><span class="nx">object</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">Proxy</span><span class="p">(</span><span class="nx">object</span><span class="p">,</span> <span class="p">{</span>
          <span class="na">set</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">target</span><span class="p">,</span> <span class="nx">property</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
              <span class="kd">var</span> <span class="nx">currentType</span> <span class="o">=</span> <span class="k">typeof</span> <span class="nx">target</span><span class="p">[</span><span class="nx">property</span><span class="p">],</span>
                  <span class="nx">newType</span> <span class="o">=</span> <span class="k">typeof</span> <span class="nx">value</span><span class="p">;</span>

              <span class="k">if</span> <span class="p">(</span><span class="nx">property</span> <span class="k">in</span> <span class="nx">target</span> <span class="o">&amp;&amp;</span> <span class="nx">currentType</span> <span class="o">!==</span> <span class="nx">newType</span><span class="p">)</span> <span class="p">{</span>
                  <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">"Property "</span> <span class="o">+</span> <span class="nx">property</span> <span class="o">+</span> <span class="s2">" must be a "</span> <span class="o">+</span> <span class="nx">currentType</span> <span class="o">+</span> <span class="s2">"."</span><span class="p">);</span>
              <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                  <span class="nx">target</span><span class="p">[</span><span class="nx">property</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span>
              <span class="p">}</span>
          <span class="p">}</span>
    <span class="p">});</span>
<span class="p">}</span>
</code></pre>
</div>

<p>写到constructor中</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">Person</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">name</span><span class="p">;</span>
    <span class="k">return</span> <span class="nx">createTypeSafeObject</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">person</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Person</span><span class="p">(</span><span class="s2">"Nicholas"</span><span class="p">);</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">person</span> <span class="k">instanceof</span> <span class="nx">Person</span><span class="p">);</span>    <span class="c1">// true</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">person</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>                 <span class="c1">// "Nicholas"</span>
</code></pre>
</div>

<h4 id="data-binding-set">Data binding (set)</h4>

<p>用proxy在set之前添加callback</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">createObservedArray</span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">array</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">Proxy</span><span class="p">(</span><span class="nx">array</span><span class="p">,</span> <span class="p">{</span>
        <span class="nx">set</span><span class="p">(</span><span class="nx">target</span><span class="p">,</span> <span class="nx">propertyKey</span><span class="p">,</span> <span class="nx">value</span><span class="p">,</span> <span class="nx">receiver</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">callback</span><span class="p">(</span><span class="nx">propertyKey</span><span class="p">,</span> <span class="nx">value</span><span class="p">);</span>
            <span class="k">return</span> <span class="nx">Reflect</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">target</span><span class="p">,</span> <span class="nx">propertyKey</span><span class="p">,</span> <span class="nx">value</span><span class="p">,</span> <span class="nx">receiver</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">});</span>    
<span class="p">}</span>
<span class="kr">const</span> <span class="nx">observedArray</span> <span class="o">=</span> <span class="nx">createObservedArray</span><span class="p">(</span>
    <span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="err">`</span><span class="nx">$</span><span class="p">{</span><span class="nx">key</span><span class="p">}</span><span class="o">=</span><span class="nx">$</span><span class="p">{</span><span class="nx">value</span><span class="p">}</span><span class="err">`</span><span class="p">));</span>

<span class="nx">observedArray</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s1">'a'</span><span class="p">);</span>

<span class="c1">// "0=a"</span>
<span class="c1">// "length=1"</span>
</code></pre>
</div>

<h4 id="accessing-a-restful-web-service-method-calls">Accessing a restful web service (method calls)</h4>

<p>返回一个proxy, 可以执行任何方法，因为截断了get方法</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">createWebService</span><span class="p">(</span><span class="nx">baseUrl</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">Proxy</span><span class="p">({},</span> <span class="p">{</span>
        <span class="nx">get</span><span class="p">(</span><span class="nx">target</span><span class="p">,</span> <span class="nx">propKey</span><span class="p">,</span> <span class="nx">receiver</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// Return the method to be called</span>
            <span class="k">return</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">httpGet</span><span class="p">(</span><span class="nx">baseUrl</span><span class="o">+</span><span class="s1">'/'</span><span class="o">+</span><span class="nx">propKey</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">});</span>
<span class="p">}</span>
</code></pre>
</div>

<h4 id="revocable-references">Revocable references</h4>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="kr">const</span> <span class="nx">resource</span> <span class="o">=</span> <span class="p">{</span> <span class="na">x</span><span class="p">:</span> <span class="mi">11</span><span class="p">,</span> <span class="na">y</span><span class="p">:</span> <span class="mi">8</span> <span class="p">};</span>
<span class="kr">const</span> <span class="p">{</span><span class="nx">reference</span><span class="p">,</span> <span class="nx">revoke</span><span class="p">}</span> <span class="o">=</span> <span class="nx">createRevocableReference</span><span class="p">(</span><span class="nx">resource</span><span class="p">);</span>

<span class="c1">// Access granted</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">reference</span><span class="p">.</span><span class="nx">x</span><span class="p">);</span> <span class="c1">// 11</span>

<span class="nx">revoke</span><span class="p">();</span>

<span class="c1">// Access denied</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">reference</span><span class="p">.</span><span class="nx">x</span><span class="p">);</span> <span class="c1">// TypeError: Revoked</span>
</code></pre>
</div>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">createRevocableReference</span><span class="p">(</span><span class="nx">target</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">enabled</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="na">reference</span><span class="p">:</span> <span class="k">new</span> <span class="nx">Proxy</span><span class="p">(</span><span class="nx">target</span><span class="p">,</span> <span class="p">{</span>
            <span class="nx">get</span><span class="p">(</span><span class="nx">target</span><span class="p">,</span> <span class="nx">propKey</span><span class="p">,</span> <span class="nx">receiver</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">enabled</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">throw</span> <span class="k">new</span> <span class="nx">TypeError</span><span class="p">(</span><span class="s1">'Revoked'</span><span class="p">);</span>
                <span class="p">}</span>
                <span class="k">return</span> <span class="nx">Reflect</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">target</span><span class="p">,</span> <span class="nx">propKey</span><span class="p">,</span> <span class="nx">receiver</span><span class="p">);</span>
            <span class="p">},</span>
            <span class="nx">has</span><span class="p">(</span><span class="nx">target</span><span class="p">,</span> <span class="nx">propKey</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">enabled</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">throw</span> <span class="k">new</span> <span class="nx">TypeError</span><span class="p">(</span><span class="s1">'Revoked'</span><span class="p">);</span>
                <span class="p">}</span>
                <span class="k">return</span> <span class="nx">Reflect</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="nx">target</span><span class="p">,</span> <span class="nx">propKey</span><span class="p">);</span>
            <span class="p">},</span>
            <span class="err">···</span>
        <span class="p">}),</span>
        <span class="nx">revoke</span><span class="p">()</span> <span class="p">{</span>
            <span class="nx">enabled</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">},</span>
    <span class="p">};</span>
<span class="p">}</span>
</code></pre>
</div>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">createRevocableReference</span><span class="p">(</span><span class="nx">target</span><span class="p">)</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">handler</span> <span class="o">=</span> <span class="p">{};</span> <span class="c1">// forward everything</span>
    <span class="kr">const</span> <span class="p">{</span> <span class="nx">proxy</span><span class="p">,</span> <span class="nx">revoke</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">Proxy</span><span class="p">.</span><span class="nx">revocable</span><span class="p">(</span><span class="nx">target</span><span class="p">,</span> <span class="nx">handler</span><span class="p">);</span>
    <span class="k">return</span> <span class="p">{</span> <span class="na">reference</span><span class="p">:</span> <span class="nx">proxy</span><span class="p">,</span> <span class="nx">revoke</span> <span class="p">};</span>
<span class="p">}</span>
</code></pre>
</div>

<h3 id="the-design-of-the-proxy-api">The design of the proxy API</h3>

<p><code class="highlighter-rouge">obj.hasOwnProperty(propKey)</code>一旦<code class="highlighter-rouge">obj</code>或<code class="highlighter-rouge">obj</code>的<code class="highlighter-rouge">proto</code>覆盖掉了<code class="highlighter-rouge">hasOwnProperty</code>方法会产生问题</p>

<p>正确的使用方法是<code class="highlighter-rouge">Object.prototype.hasOwnProperty.call(obj, propKey)
</code>
###  Transparent virtualization and handler encapsulation</p>

<p>Proxies are shielded in two ways:</p>

<ul>
  <li>
    <p>It is impossible to determine whether an object is a proxy or not (transparent virtualization).</p>
  </li>
  <li>
    <p>You can’t access a handler via its proxy (handler encapsulation).</p>
  </li>
</ul>

<p>查看一个obj是否是proxy</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="c1">// lib.js</span>
<span class="kr">const</span> <span class="nx">proxies</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">WeakSet</span><span class="p">();</span>

<span class="kr">export</span> <span class="kd">function</span> <span class="nx">createProxy</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">handler</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="kr">const</span> <span class="nx">proxy</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Proxy</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">handler</span><span class="p">);</span>
    <span class="nx">proxies</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">proxy</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">proxy</span><span class="p">;</span>
<span class="p">}</span>

<span class="kr">export</span> <span class="kd">function</span> <span class="nx">isProxy</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">proxies</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="nx">obj</span><span class="p">);</span>
<span class="p">}</span>
</code></pre>
</div>

<h4 id="the-meta-object-protocol-and-proxy-traps">The meta object protocol and proxy traps</h4>

<p>the meta object protocol (MOP)</p>

<p>The JavaScript MOP consists of own internal methods that all objects have.</p>

<p>??? 一堆dynamic dispatch 没看懂</p>

<h3 id="protect-object">protect object</h3>

<p>There are two ways of protecting objects:</p>

<ul>
  <li>Non-extensibility protects objects</li>
  <li>Non-configurability protects properties (or rather, their attributes)</li>
</ul>

<p>Non-extensibility. If an object is non-extensible, you <code class="highlighter-rouge">can’t add properties</code> and you <code class="highlighter-rouge">can’t change its prototype</code>:</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="kr">const</span> <span class="nx">obj</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">preventExtensions</span><span class="p">({});</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nb">Object</span><span class="p">.</span><span class="nx">isExtensible</span><span class="p">(</span><span class="nx">obj</span><span class="p">));</span> <span class="c1">// false</span>
<span class="nx">obj</span><span class="p">.</span><span class="nx">foo</span> <span class="o">=</span> <span class="mi">123</span><span class="p">;</span> <span class="c1">// TypeError: object is not extensible</span>
<span class="nb">Object</span><span class="p">.</span><span class="nx">setPrototypeOf</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="kc">null</span><span class="p">);</span> <span class="c1">// TypeError: object is not extensible</span>
</code></pre>
</div>

<p>Non-configurability</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="kr">const</span> <span class="nx">obj</span> <span class="o">=</span> <span class="p">{};</span>
<span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="s1">'foo'</span><span class="p">,</span> <span class="p">{</span>
    <span class="na">value</span><span class="p">:</span> <span class="mi">123</span><span class="p">,</span>
    <span class="na">writable</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="na">configurable</span><span class="p">:</span> <span class="kc">false</span>
<span class="p">});</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">foo</span><span class="p">);</span> <span class="c1">// 123</span>
<span class="nx">obj</span><span class="p">.</span><span class="nx">foo</span> <span class="o">=</span> <span class="s1">'a'</span><span class="p">;</span> <span class="c1">// TypeError: Cannot assign to read only property</span>

<span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="s1">'foo'</span><span class="p">,</span> <span class="p">{</span>
    <span class="na">configurable</span><span class="p">:</span> <span class="kc">true</span>
<span class="p">});</span> <span class="c1">// TypeError: Cannot redefine property</span>
</code></pre>
</div>

<p>他们的两个特点</p>

<ul>
  <li>Universal: they work for all objects.</li>
  <li>Monotonic: once switched on, they can’t be switched off again.</li>
</ul>


  </div>

</article>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading"></h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li></li>
          <li><a href="mailto:"></a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
          

          
        </ul>
      </div>

      <div class="footer-col footer-col-3">
        <p></p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
